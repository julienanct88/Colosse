<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="Colosse"/>
  <meta name="theme-color" content="#08080d"/>
  <meta name="description" content="Colosse ‚Äî Programme PPL 12 semaines"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="apple-touch-icon" href="icon-192.png"/>
  <title>Colosse ‚Äî Coach PPL</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    body{background:#08080d;overflow-x:hidden;font-family:'DM Sans',sans-serif}
    #root{min-height:100vh}
    input,textarea,button{font-family:inherit}
    @keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
    ::-webkit-scrollbar{display:none}
  </style>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

/* ‚ïê‚ïê‚ïê WAKE LOCK ‚ïê‚ïê‚ïê */
function useWakeLock(on){const r=useRef(null);useEffect(()=>{if(!on||!("wakeLock"in navigator))return;let ok=true;const q=async()=>{try{r.current=await navigator.wakeLock.request("screen");r.current.addEventListener("release",()=>{if(ok)q()})}catch(e){}};q();const v=()=>{if(document.visibilityState==="visible"&&ok)q()};document.addEventListener("visibilitychange",v);return()=>{ok=false;document.removeEventListener("visibilitychange",v);if(r.current)r.current.release().catch(()=>{})};},[on]);}

/* ‚ïê‚ïê‚ïê PROGRAMME VALID√â ‚ïê‚ïê‚ïê */
const YT="https://www.youtube.com/results?search_query=";
const DAYS=[
  {id:0,key:"pushA",name:"Push A",label:"Pecs focus",day:"Lundi",color:"#EF4444",icon:"üî¥",exs:[
    {id:"pa1",name:"D√©velopp√© couch√© barre",tp:"barbell",sets:4,rLo:8,rHi:10,lk:true,yt:"d√©velopp√©+couch√©+barre+technique+musculation"},
    {id:"pa2",name:"D√©velopp√© inclin√© halt√®res",tp:"dumbbell",sets:4,rLo:10,rHi:12,lk:true,yt:"d√©velopp√©+inclin√©+halt√®res+technique"},
    {id:"pa3",name:"Dips lest√©s",tp:"barbell",sets:3,rLo:8,rHi:10,lk:true,yt:"dips+lest√©s+pectoraux+technique"},
    {id:"pa4",name:"√âcart√©s poulie haute",tp:"cable",sets:3,rLo:12,rHi:15,yt:"√©cart√©+poulie+vis+√†+vis+cable+fly"},
    {id:"pa5",name:"Barre au front (skullcrusher)",tp:"barbell",sets:3,rLo:10,rHi:12,yt:"barre+au+front+skullcrusher+triceps+technique"},
    {id:"pa6",name:"Extensions triceps poulie",tp:"cable",sets:3,rLo:12,rHi:15,yt:"extension+triceps+poulie+haute+technique"},
  ]},
  {id:1,key:"pullA",name:"Pull A",label:"Dos √©paisseur",day:"Mardi",color:"#3B82F6",icon:"üîµ",exs:[
    {id:"la1",name:"Soulev√© de terre",tp:"barbell",sets:4,rLo:5,rHi:8,lk:true,yt:"soulev√©+de+terre+conventionnel+technique+deadlift"},
    {id:"la2",name:"Rowing barre pronation",tp:"barbell",sets:4,rLo:8,rHi:10,lk:true,yt:"rowing+barre+pronation+bent+over+row+technique"},
    {id:"la3",name:"Rowing 1 bras halt√®re",tp:"dumbbell",sets:3,rLo:10,rHi:12,lk:true,yt:"rowing+un+bras+halt√®re+one+arm+dumbbell+row"},
    {id:"la4",name:"Curl barre EZ",tp:"barbell",sets:3,rLo:10,rHi:12,yt:"curl+barre+EZ+biceps+technique"},
    {id:"la5",name:"Curl marteau",tp:"dumbbell",sets:3,rLo:10,rHi:12,yt:"curl+marteau+hammer+curl+technique"},
    {id:"la6",name:"Curl invers√© EZ",tp:"barbell",sets:3,rLo:12,rHi:15,yt:"reverse+curl+barre+EZ+avant+bras+technique"},
    {id:"la7",name:"Face pulls poulie",tp:"cable",sets:3,rLo:12,rHi:15,yt:"face+pull+poulie+deltoide+posterieur+technique"},
  ]},
  {id:2,key:"legsA",name:"Legs A",label:"Quads focus",day:"Mercredi",color:"#10B981",icon:"üü¢",exs:[
    {id:"qa1",name:"Back squat",tp:"barbell",sets:4,rLo:6,rHi:8,lk:true,yt:"back+squat+barre+technique+musculation"},
    {id:"qa2",name:"Presse jambes",tp:"machine",sets:4,rLo:10,rHi:12,lk:true,yt:"presse+jambes+leg+press+technique"},
    {id:"qa3",name:"Leg extension",tp:"machine",sets:3,rLo:12,rHi:15,yt:"leg+extension+quadriceps+technique"},
    {id:"qa4",name:"RDL (Romanian DL)",tp:"barbell",sets:3,rLo:10,rHi:12,yt:"romanian+deadlift+RDL+technique+ischio"},
    {id:"qa5",name:"Mollets debout",tp:"machine",sets:4,rLo:12,rHi:15,yt:"mollets+debout+machine+standing+calf+raise"},
    {id:"qa6",name:"Crunch poulie haute",tp:"cable",sets:3,rLo:12,rHi:15,yt:"crunch+poulie+haute+cable+crunch+abdos"},
    {id:"qa7",name:"Relev√©s jambes suspendus",tp:"barbell",sets:3,rLo:10,rHi:12,yt:"relev√©+jambes+suspendu+hanging+leg+raise+abdos"},
  ]},
  {id:3,key:"pushB",name:"Push B",label:"√âpaules focus",day:"Jeudi",color:"#EF4444",icon:"üî¥",exs:[
    {id:"pb1",name:"D√©velopp√© militaire barre",tp:"barbell",sets:4,rLo:8,rHi:10,lk:true,yt:"d√©velopp√©+militaire+barre+overhead+press+technique"},
    {id:"pb2",name:"D√©velopp√© couch√© halt√®res",tp:"dumbbell",sets:4,rLo:10,rHi:12,lk:true,yt:"d√©velopp√©+couch√©+halt√®res+dumbbell+bench+press"},
    {id:"pb3",name:"√âl√©vations lat√©rales",tp:"dumbbell",sets:4,rLo:12,rHi:15,yt:"√©l√©vations+lat√©rales+halt√®res+lateral+raise+technique"},
    {id:"pb4",name:"Push press",tp:"barbell",sets:3,rLo:6,rHi:8,lk:true,yt:"push+press+barre+technique+√©paules"},
    {id:"pb5",name:"Ext. triceps overhead",tp:"cable",sets:3,rLo:10,rHi:12,yt:"extension+triceps+overhead+poulie+technique"},
    {id:"pb6",name:"Dips prise serr√©e",tp:"barbell",sets:3,rLo:8,rHi:10,lk:true,yt:"dips+prise+serr√©e+triceps+masse+technique"},
    {id:"pb7",name:"√âcart√©s inclin√©s halt√®res",tp:"dumbbell",sets:3,rLo:10,rHi:12,yt:"√©cart√©+inclin√©+halt√®res+pectoraux+technique"},
  ]},
  {id:4,key:"pullB",name:"Pull B",label:"Dos largeur",day:"Vendredi",color:"#3B82F6",icon:"üîµ",exs:[
    {id:"lb1",name:"Tractions lest√©es",tp:"barbell",sets:4,rLo:6,rHi:10,lk:true,yt:"tractions+lest√©es+pull+ups+weighted+technique"},
    {id:"lb2",name:"Tirage vertical large",tp:"cable",sets:4,rLo:10,rHi:12,lk:true,yt:"tirage+vertical+prise+large+lat+pulldown+technique"},
    {id:"lb3",name:"Rowing T-bar",tp:"machine",sets:4,rLo:8,rHi:10,lk:true,yt:"rowing+t-bar+technique+dos+√©paisseur"},
    {id:"lb4",name:"Curl inclin√© 45¬∞",tp:"dumbbell",sets:3,rLo:10,rHi:12,yt:"curl+inclin√©+45+degr√©s+halt√®res+biceps+technique"},
    {id:"lb5",name:"Curl concentr√©",tp:"dumbbell",sets:3,rLo:10,rHi:12,yt:"curl+concentr√©+concentration+curl+technique"},
    {id:"lb6",name:"Wrist curls",tp:"barbell",sets:3,rLo:15,rHi:20,yt:"wrist+curl+avant+bras+forearm+technique"},
    {id:"lb7",name:"Oiseau invers√© halt√®res",tp:"dumbbell",sets:3,rLo:12,rHi:15,yt:"oiseau+invers√©+reverse+fly+deltoide+posterieur+technique"},
  ]},
  {id:5,key:"legsB",name:"Legs B",label:"Ischios/fessiers",day:"Samedi",color:"#10B981",icon:"üü¢",exs:[
    {id:"qb1",name:"Front squat",tp:"barbell",sets:4,rLo:8,rHi:10,lk:true,yt:"front+squat+barre+technique+quadriceps"},
    {id:"qb2",name:"Hip thrust barre",tp:"barbell",sets:4,rLo:10,rHi:12,lk:true,yt:"hip+thrust+barre+technique+fessiers"},
    {id:"qb3",name:"Leg curl allong√©",tp:"machine",sets:3,rLo:10,rHi:12,yt:"leg+curl+allong√©+lying+leg+curl+ischio"},
    {id:"qb4",name:"Split squat bulgare",tp:"dumbbell",sets:3,rLo:10,rHi:12,yt:"split+squat+bulgare+bulgarian+split+squat+technique"},
    {id:"qb5",name:"Mollets assis",tp:"machine",sets:4,rLo:15,rHi:20,yt:"mollets+assis+seated+calf+raise+technique"},
    {id:"qb6",name:"Planche lest√©e",tp:"barbell",sets:3,rLo:1,rHi:1,yt:"planche+lest√©e+weighted+plank+abdos+technique"},
    {id:"qb7",name:"Ab wheel rollout",tp:"barbell",sets:3,rLo:10,rHi:12,yt:"ab+wheel+rollout+roue+abdominale+technique"},
  ]},
];

const PHASES=[
  {w:1,p:"R√©activation",c:"#F59E0B",d:"29 jan"},{w:2,p:"R√©activation",c:"#F59E0B",d:"5 f√©v"},
  {w:3,p:"R√©activation",c:"#F59E0B",d:"12 f√©v"},{w:4,p:"Hypertrophie",c:"#EF4444",d:"19 f√©v"},
  {w:5,p:"Hypertrophie",c:"#EF4444",d:"26 f√©v"},{w:6,p:"Hypertrophie",c:"#EF4444",d:"5 mars"},
  {w:7,p:"Consolidation",c:"#8B5CF6",d:"12 mars"},{w:8,p:"Consolidation",c:"#8B5CF6",d:"19 mars"},
  {w:9,p:"Maturation",c:"#10B981",d:"26 mars"},{w:10,p:"Maturation",c:"#10B981",d:"2 avr"},
  {w:11,p:"Maturation",c:"#10B981",d:"9 avr"},{w:12,p:"R√©sultat",c:"#3B82F6",d:"16 avr"},
];

/* ‚ïê‚ïê‚ïê PHASE CONFIG ‚Äî rep ranges & rest ‚ïê‚ïê‚ïê */
const PCFG={
  "R√©activation":{cLo:10,cHi:12,iLo:12,iHi:15,rest:90,desc:"L√©ger, technique, r√©veiller les muscles"},
  "Hypertrophie":{cLo:8,cHi:10,iLo:10,iHi:12,rest:120,desc:"Lourd, volume max, casser les fibres"},
  "Consolidation":{cLo:6,cHi:8,iLo:8,iHi:10,rest:150,desc:"Tr√®s lourd, peu de reps, force pure"},
  "Maturation":{cLo:8,cHi:10,iLo:10,iHi:12,rest:120,desc:"Lourd + ma√Ætris√©, densit√© musculaire"},
  "R√©sultat":{cLo:8,cHi:10,iLo:10,iHi:12,rest:120,desc:"Semaine test ‚Äî mesure tes r√©sultats"},
};

function getRepRange(ex,phaseName){
  var cfg=PCFG[phaseName]||PCFG["Hypertrophie"];
  if(ex.lk) return {lo:cfg.cLo,hi:cfg.cHi}; // compos√©
  return {lo:cfg.iLo,hi:cfg.iHi}; // isolation
}

function getPhaseRest(phaseName){
  var cfg=PCFG[phaseName];
  return cfg?cfg.rest:120;
}

const MEAS=[
  {id:"poids",nm:"Poids corps",u:"kg",ic:"‚öñÔ∏è"},
  {id:"bras_c",nm:"Bras contract√©",u:"cm",ic:"üí™"},
  {id:"bras_r",nm:"Bras repos",u:"cm",ic:"üí™"},
  {id:"poitrine",nm:"Poitrine",u:"cm",ic:"ü´Å"},
  {id:"taille",nm:"Taille",u:"cm",ic:"üìè"},
  {id:"cuisse",nm:"Cuisse",u:"cm",ic:"ü¶µ"},
];

const INC={barbell:2.5,dumbbell:1,machine:2.5,cable:1.25};
const REST_P=[60,90,120,150,180];

/* ‚ïê‚ïê‚ïê S1 DATA (mapped to new program) ‚ïê‚ïê‚ïê */
const S1={
  pa1:[[70,6],[70,5],[60,5],[40,10]], // DC barre from old J4
  la1:[[45,8],[45,8],[45,10],[45,4]], // SDT from old J2
  la2:[[45,6],[46,6],[45,8],[45,6]], // Rowing pronation
  la3:[[20,10],[20,10],[20,10]], // Rowing 1 bras
  la4:[[15,10],[15,10],[15,10]], // Curl EZ
  la5:[[18,12],[18,12],[18,12]], // Curl marteau
  la6:[[12.5,12],[12.5,12],[12.5,12]], // Curl invers√© (from reverse curl)
  qa1:[[120,5],[120,5],[120,5],[80,10]], // Back squat
  qa2:[[180,12],[180,12],[180,12],[180,5]], // Presse
  qa3:[[35,12],[35,12],[35,12]], // Leg ext
  qa4:[[35,8],[35,8],[36,8]], // RDL
  qa5:[[180,15],[180,15],[180,15],[180,15]], // Mollets debout
  pb4:[[20,12],[20,12],[20,10]], // Push press
  pb5:[[17.5,12],[17.5,12],[17.5,10]], // Ext overhead
  lb1:[[0,6],[0,6],[0,6],[0,6]], // Tractions (PDC)
  lb2:[[100,10],[100,8],[100,6],[90,10]], // Tirage vertical
  lb3:[[80,10],[80,8],[40,10],[40,10]], // T-bar
  lb4:[[12,10],[12,10],[12,10]], // Curl inclin√©
  lb5:[[17.5,12],[17.5,12]], // Curl concentr√©
  qb1:[[30,5],[30,5],[20,6],[20,10]], // Front squat
  qb2:[[80,12],[80,12],[80,12]], // Hip thrust (from old data)
  qb3:[[35,12],[35,10],[35,8]], // Leg curl
  qb4:[[12,10],[12,10],[12,8]], // Split squat
  qb5:[[110,20],[110,20],[110,20],[90,20]], // Mollets assis
};
const S1M={poids:"95",bras_c:"39",bras_r:"35",poitrine:"",taille:"",cuisse:""};

/* ‚ïê‚ïê‚ïê STORAGE ‚ïê‚ïê‚ïê */
const SK="colosse-coach-v2";
function load(){try{var r=localStorage.getItem(SK);return r?JSON.parse(r):null}catch(e){return null}}
function save(d){try{localStorage.setItem(SK,JSON.stringify(d))}catch(e){}}

/* ‚ïê‚ïê‚ïê DATA MIGRATION ‚Äî ensure all exercises exist in saved data ‚ïê‚ïê‚ïê */
function migrateData(st){
  if(!st||!st.wk)return st;
  var changed=false;
  Object.keys(st.wk).forEach(function(wNum){
    var wd=st.wk[wNum];if(!wd||!wd.ds)return;
    DAYS.forEach(function(day){
      if(!wd.ds[day.key])wd.ds[day.key]={};
      day.exs.forEach(function(ex){
        if(!wd.ds[day.key][ex.id]){
          wd.ds[day.key][ex.id]={s:mkS(ex.sets),tw:"",tr:""};
          changed=true;
        }
        // Also fix if sets count changed
        var cur=wd.ds[day.key][ex.id];
        if(cur.s.length<ex.sets){while(cur.s.length<ex.sets)cur.s.push({w:"",r:"",d:false});changed=true}
      });
    });
    if(!wd.ms){wd.ms={};MEAS.forEach(function(m){wd.ms[m.id]=""});changed=true}
    if(typeof wd.nt==="undefined"){wd.nt="";changed=true}
  });
  // Ensure ord exists
  if(!st.ord){st.ord={};DAYS.forEach(function(d){st.ord[d.key]=d.exs.map(function(e){return e.id})});changed=true}
  else{DAYS.forEach(function(d){if(!st.ord[d.key])st.ord[d.key]=d.exs.map(function(e){return e.id});else{d.exs.forEach(function(e){if(st.ord[d.key].indexOf(e.id)===-1){st.ord[d.key].push(e.id);changed=true}})}})}
  if(changed)save(st);
  return st;
}

function mkS(n){var a=[];for(var i=0;i<n;i++)a.push({w:"",r:"",d:false});return a}

function emptyW(){
  var ds={};
  DAYS.forEach(function(day){var o={};day.exs.forEach(function(ex){o[ex.id]={s:mkS(ex.sets),tw:"",tr:""}});ds[day.key]=o});
  var ms={};MEAS.forEach(function(m){ms[m.id]=""});
  return{ds:ds,ms:ms,nt:""};
}

function buildS1(){
  var w=emptyW();
  Object.keys(S1).forEach(function(eid){
    DAYS.forEach(function(day){
      if(!w.ds[day.key][eid])return;
      var raw=S1[eid],sets=[];
      raw.forEach(function(s){sets.push({w:s[0]>0?String(s[0]):"",r:String(s[1]),d:true})});
      var tgt=4;day.exs.forEach(function(e){if(e.id===eid)tgt=e.sets});
      while(sets.length<tgt)sets.push({w:"",r:"",d:false});
      w.ds[day.key][eid]={s:sets,tw:"",tr:""};
    });
  });
  Object.keys(S1M).forEach(function(k){w.ms[k]=S1M[k]});
  w.nt="S1 R√©activation ‚Äî Reprise en douceur, m√©moire musculaire active.";
  return w;
}

function init(){var wk={};for(var i=1;i<=12;i++)wk[i]=emptyW();wk[1]=buildS1();var ord={};DAYS.forEach(function(d){ord[d.key]=d.exs.map(function(e){return e.id})});return{wk:wk,cw:2,ord:ord}}

/* ‚ïê‚ïê‚ïê PROGRESSION ‚ïê‚ïê‚ïê */
function compObj(exDef,prev,rng){
  if(!prev||!rng)return null;
  var dn=prev.s.filter(function(s){return s.d&&s.w&&parseFloat(s.w)>0});
  if(dn.length===0)return null;
  var best=0;dn.forEach(function(s){var v=parseFloat(s.w)||0;if(v>best)best=v});
  if(best===0)return null;
  var atB=dn.filter(function(s){return(parseFloat(s.w)||0)===best});
  var minR=9999;atB.forEach(function(s){var v=parseInt(s.r)||0;if(v<minR)minR=v});
  var inc=INC[exDef.tp]||2.5;
  if(minR>=rng.hi)return{w:String(best+inc),r:String(rng.lo)};
  return{w:String(best),r:String(Math.min(minR+1,rng.hi))};
}

/* ‚ïê‚ïê‚ïê EXERCISE ORDER ‚ïê‚ïê‚ïê */
function getOrderedExs(dayDef, order) {
  if (!order) return dayDef.exs;
  var locked = dayDef.exs.filter(function(e) { return e.lk; });
  var free = dayDef.exs.filter(function(e) { return !e.lk; });
  // Sort free by saved order
  var freeOrder = order.filter(function(id) { return free.some(function(e) { return e.id === id; }); });
  // Add any missing (new exercises)
  free.forEach(function(e) { if (freeOrder.indexOf(e.id) === -1) freeOrder.push(e.id); });
  var sortedFree = freeOrder.map(function(id) { return free.find(function(e) { return e.id === id; }); }).filter(Boolean);
  return locked.concat(sortedFree);
}

/* ‚ïê‚ïê‚ïê COMPONENTS ‚ïê‚ïê‚ïê */
function MBar({v,mx,c}){var p=mx>0?Math.min(v/mx*100,100):0;return<div style={{height:4,background:"rgba(255,255,255,.06)",borderRadius:2,flex:1}}><div style={{height:"100%",width:p+"%",background:c,borderRadius:2,transition:"width .4s"}}/></div>}

function Inp({value,onChange,ph,width}){
  return<input type="text" inputMode="decimal" value={value} onChange={function(e){onChange(e.target.value)}} placeholder={ph||""} style={{width:width||54,padding:"7px 4px",borderRadius:8,border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.04)",color:"#fff",fontSize:14,fontFamily:"'JetBrains Mono',monospace",fontWeight:600,textAlign:"center",outline:"none"}} onFocus={function(e){e.target.style.borderColor="rgba(255,255,255,.3)"}} onBlur={function(e){e.target.style.borderColor="rgba(255,255,255,.1)"}}/>;
}

function Chk({on,toggle,c}){
  return<button onClick={toggle} style={{width:26,height:26,borderRadius:"50%",border:"2px solid "+(on?c:"rgba(255,255,255,.12)"),background:on?c:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0,flexShrink:0}}>
    {on&&<svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M2 6L5 9L10 3" stroke="#fff" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>}
  </button>;
}

/* ‚ïê‚ïê‚ïê TIMER ‚ïê‚ïê‚ïê */
function Timer({sec,c,onEnd,onSkip,onDC}){
  const[rem,setRem]=useState(sec);
  const[pau,setPau]=useState(false);
  const tot=useRef(sec);
  const au=useRef(null);
  useEffect(()=>{setRem(sec);tot.current=sec},[sec]);
  const cbEnd=useCallback(onEnd,[]);
  useEffect(()=>{
    if(pau)return;
    if(rem<=0){
      try{if(!au.current)au.current=new(window.AudioContext||window.webkitAudioContext)();var x=au.current;[0,.2,.4].forEach(function(d){var o=x.createOscillator(),g=x.createGain();o.connect(g);g.connect(x.destination);o.frequency.value=880;g.gain.value=.3;o.start(x.currentTime+d);o.stop(x.currentTime+d+.12)})}catch(e){}
      try{navigator.vibrate&&navigator.vibrate([200,100,200])}catch(e){}
      cbEnd();return;
    }
    var t=setTimeout(function(){setRem(function(r){return r-1})},1000);
    return function(){clearTimeout(t)};
  },[rem,pau,cbEnd]);
  var pct=tot.current>0?rem/tot.current:0,R=52,ci=2*Math.PI*R,of=ci*(1-pct);
  var m=Math.floor(rem/60),s=rem%60,lo=rem<=5&&rem>0;
  return<div style={{position:"fixed",bottom:0,left:0,right:0,zIndex:9999,display:"flex",flexDirection:"column",alignItems:"center",padding:"16px 16px 24px",background:"linear-gradient(to top,rgba(8,8,13,.98),rgba(8,8,13,.9))",backdropFilter:"blur(20px)",borderTop:"1px solid "+c+"30",animation:"slideUp .3s ease-out"}}>
    <div style={{fontSize:9,fontWeight:700,textTransform:"uppercase",letterSpacing:2,color:"rgba(255,255,255,.3)",marginBottom:10}}>‚è± REPOS</div>
    <div style={{position:"relative",width:115,height:115,marginBottom:12}}>
      <svg width="115" height="115" viewBox="0 0 120 120" style={{transform:"rotate(-90deg)"}}><circle cx="60" cy="60" r={R} fill="none" stroke="rgba(255,255,255,.06)" strokeWidth="5"/><circle cx="60" cy="60" r={R} fill="none" stroke={lo?"#EF4444":c} strokeWidth="5" strokeLinecap="round" strokeDasharray={ci} strokeDashoffset={of} style={{transition:"stroke-dashoffset 1s linear"}}/></svg>
      <div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",animation:lo?"pulse .5s infinite":"none"}}><span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:30,fontWeight:700,color:lo?"#EF4444":"#fff"}}>{m}:{s.toString().padStart(2,"0")}</span></div>
    </div>
    <div style={{display:"flex",gap:4,marginBottom:10}}>{REST_P.map(function(p){return<button key={p} onClick={function(){setRem(p);tot.current=p;if(onDC)onDC(p)}} style={{padding:"4px 8px",borderRadius:6,border:tot.current===p?"1px solid "+c+"60":"1px solid rgba(255,255,255,.06)",background:tot.current===p?c+"15":"transparent",color:tot.current===p?c:"rgba(255,255,255,.3)",fontSize:10,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",cursor:"pointer"}}>{Math.floor(p/60)+":"+(p%60).toString().padStart(2,"0")}</button>})}</div>
    <div style={{display:"flex",gap:8}}>
      <button onClick={function(){setPau(function(p){return!p})}} style={{padding:"8px 20px",borderRadius:10,border:"1px solid rgba(255,255,255,.1)",background:"rgba(255,255,255,.05)",color:"#fff",fontSize:12,fontWeight:600,cursor:"pointer"}}>{pau?"‚ñ∂":"‚è∏"} {pau?"Go":"Pause"}</button>
      <button onClick={onSkip} style={{padding:"8px 20px",borderRadius:10,border:"1px solid rgba(255,255,255,.05)",background:"rgba(255,255,255,.02)",color:"rgba(255,255,255,.3)",fontSize:12,fontWeight:600,cursor:"pointer"}}>Passer ‚úï</button>
    </div>
  </div>;
}

/* ‚ïê‚ïê‚ïê EXERCISE CARD ‚ïê‚ïê‚ïê */
function ExCard({ex,data,prev,color,upd,onDone,isLk,canUp,canDn,onUp,onDn,phaseName}){
  if(!data||!data.s)return null; // safety guard
  var rng=getRepRange(ex,phaseName);
  var ao=prev?compObj(ex,prev,rng):null;
  var dW=data.tw||(ao?ao.w:""),dR=data.tr||(ao?ao.r:"");
  var tW=parseFloat(dW)||0,tR=parseInt(dR)||0;
  var isA=!data.tw&&!data.tr&&ao&&ao.w;
  var dn=data.s.filter(function(s){return s.d}),dc=dn.length,tc=data.s.length;
  var allH=tW>0&&tR>0&&dc>=Math.max(tc-1,1)&&dn.every(function(s){return(parseFloat(s.w)||0)>=tW&&(parseInt(s.r)||0)>=tR});
  var inc=INC[ex.tp]||2.5;
  var pB=0,pBR=0;
  if(prev){prev.s.filter(function(s){return s.d&&s.w&&parseFloat(s.w)>0}).forEach(function(s){var w=parseFloat(s.w)||0;if(w>pB)pB=w});if(pB>0){var aW=prev.s.filter(function(s){return s.d&&(parseFloat(s.w)||0)===pB});pBR=999;aW.forEach(function(s){var r=parseInt(s.r)||0;if(r<pBR)pBR=r});if(pBR===999)pBR=0}}

  return<div style={{borderRadius:14,background:"rgba(255,255,255,.025)",border:"1px solid rgba(255,255,255,.06)",overflow:"hidden",marginBottom:10}}>
    {/* BANNER */}
    <div style={{padding:"12px 14px",background:allH?"rgba(16,185,129,.1)":color+"08",borderBottom:"1px solid "+(allH?"rgba(16,185,129,.2)":color+"15"),display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,flexWrap:"wrap"}}>
      <div style={{flex:1,minWidth:0}}>
        <div style={{fontSize:14,fontWeight:700,color:"#fff"}}>{isLk&&<span style={{fontSize:10,color:"rgba(255,255,255,.15)",marginRight:4}}>üîí</span>}{ex.name}
          {ex.yt&&<a href={YT+ex.yt} target="_blank" rel="noopener" style={{display:"inline-flex",alignItems:"center",justifyContent:"center",width:22,height:22,borderRadius:6,background:"rgba(255,0,0,.12)",border:"1px solid rgba(255,0,0,.2)",color:"#FF4444",fontSize:10,fontWeight:700,textDecoration:"none",marginLeft:6,verticalAlign:"middle",lineHeight:1}}>‚ñ∂</a>}
        </div>
        <div style={{fontSize:10,color:"rgba(255,255,255,.3)",marginTop:2}}>
          {ex.sets}√ó{rng.lo===rng.hi?rng.lo:(rng.lo+"-"+rng.hi)} reps ¬∑ {ex.tp}
          {pB>0&&<span style={{marginLeft:6}}>| Pr√©c: {pB}kg√ó{pBR}</span>}
        </div>
      </div>
      {/* REORDER ARROWS */}
      {!isLk&&<div style={{display:"flex",flexDirection:"column",gap:2,marginRight:6}}>
        <button onClick={onUp} disabled={!canUp} style={{width:22,height:18,borderRadius:4,border:"none",background:canUp?"rgba(255,255,255,.08)":"transparent",color:canUp?"rgba(255,255,255,.5)":"rgba(255,255,255,.1)",fontSize:10,cursor:canUp?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",padding:0}}>‚ñ≤</button>
        <button onClick={onDn} disabled={!canDn} style={{width:22,height:18,borderRadius:4,border:"none",background:canDn?"rgba(255,255,255,.08)":"transparent",color:canDn?"rgba(255,255,255,.5)":"rgba(255,255,255,.1)",fontSize:10,cursor:canDn?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",padding:0}}>‚ñº</button>
      </div>}
      <div style={{display:"flex",alignItems:"baseline",gap:3,flexShrink:0}}>
        {tW>0?<React.Fragment>
          <span style={{fontSize:9,fontWeight:700,color:allH?"#10B981":color,letterSpacing:1,marginRight:3}}>{allH?"‚úì FAIT":"üéØ OBJ"}</span>
          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:22,fontWeight:800,color:allH?"#10B981":"#fff"}}>{dW}</span>
          <span style={{fontSize:12,color:"rgba(255,255,255,.3)"}}>kg</span>
          <span style={{fontSize:14,color:"rgba(255,255,255,.15)",margin:"0 2px"}}>√ó</span>
          <span style={{fontFamily:"'JetBrains Mono',monospace",fontSize:22,fontWeight:800,color:allH?"#10B981":"#fff"}}>{dR}</span>
        </React.Fragment>:<span style={{fontSize:11,color:"rgba(255,255,255,.2)"}}>Premi√®re s√©ance</span>}
      </div>
    </div>
    {isA&&<div style={{padding:"4px 14px",fontSize:9,color:"rgba(255,255,255,.2)"}}>‚ö° Objectif auto-calcul√©{pB>0&&tW>pB&&<span style={{color:"#10B981",fontWeight:700}}> (+{(tW-pB).toFixed(1)}kg vs pr√©c.)</span>}{pB>0&&tW===pB&&tR>pBR&&<span style={{color:color,fontWeight:700}}> (+{tR-pBR} rep vs pr√©c.)</span>}</div>}
    {/* PROGRESS */}
    <div style={{padding:"6px 14px 2px",display:"flex",alignItems:"center",gap:6}}>
      <MBar v={dc} mx={tc} c={allH?"#10B981":color}/><span style={{fontSize:9,color:"rgba(255,255,255,.3)",fontWeight:600}}>{dc}/{tc}</span>
    </div>
    {/* SETS */}
    <div style={{padding:"8px 14px 14px"}}>
      {data.s.map(function(set,i){
        var w=parseFloat(set.w)||0,r=parseInt(set.r)||0;
        var hit=tW>0&&tR>0&&w>=tW&&r>=tR&&set.d;
        return<div key={i} style={{display:"flex",alignItems:"center",gap:6,marginBottom:5,opacity:set.d?1:.6}}>
          <span style={{fontSize:10,color:"rgba(255,255,255,.2)",fontWeight:600,width:18,textAlign:"center"}}>{i+1}</span>
          <Chk on={set.d} toggle={function(){upd("s_"+i+"_d",!set.d);if(!set.d)onDone()}} c={hit?"#10B981":color}/>
          <Inp value={set.w} onChange={function(v){upd("s_"+i+"_w",v)}} ph={tW>0?String(tW):"kg"} width={56}/>
          <span style={{fontSize:11,color:"rgba(255,255,255,.15)"}}>kg</span>
          <span style={{fontSize:14,color:"rgba(255,255,255,.1)"}}>√ó</span>
          <Inp value={set.r} onChange={function(v){upd("s_"+i+"_r",v)}} ph={tR>0?String(tR):""} width={42}/>
          {set.d&&hit&&<span style={{fontSize:12,color:"#10B981",fontWeight:700}}>‚úì</span>}
          {set.d&&w>0&&!hit&&tW>0&&<span style={{fontSize:9,color:"rgba(255,255,255,.18)"}}>{w<tW?"‚Üó "+((tW-w).toFixed(1))+"kg":r+"/"+tR+" reps"}</span>}
        </div>
      })}
      {allH&&<div style={{marginTop:8,padding:"8px 12px",borderRadius:8,background:"rgba(16,185,129,.08)",border:"1px solid rgba(16,185,129,.12)",fontSize:11,color:"#10B981",fontWeight:600}}>üöÄ Semaine prochaine ‚Üí {(tW+inc).toFixed(1)}kg √ó {rng.lo} reps</div>}
    </div>
  </div>;
}

/* ‚ïê‚ïê‚ïê MAIN APP ‚ïê‚ïê‚ïê */
function App(){
  const[st,setSt]=useState(null);
  const[wk,setWk]=useState(1);
  const[dayI,setDayI]=useState(0);
  const[sav,setSav]=useState(false);
  const[tmr,setTmr]=useState(false);
  const[rd,setRd]=useState(90);
  useWakeLock(true);

  // Auto-detect today
  useEffect(function(){
    var s=load();
    if(s&&s.wk){
      s=migrateData(s);
      setSt(s);var cw=(s.cw||2)-1;setWk(cw);setRd(getPhaseRest(PHASES[cw].p))
    }
    else{var d=init();setSt(d);setWk(1);setRd(getPhaseRest(PHASES[1].p))}
    var dow=new Date().getDay();
    if(dow>=1&&dow<=6)setDayI(dow-1);
    else setDayI(0);
  },[]);

  useEffect(function(){
    if(!st)return;
    var t=setTimeout(function(){setSav(true);save(st);setTimeout(function(){setSav(false)},500)},500);
    return function(){clearTimeout(t)};
  },[st]);

  if(!st)return<div style={{minHeight:"100vh",background:"#08080d",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255,255,255,.4)"}}>Chargement...</div>;

  var wN=wk+1,ph=PHASES[wk],day=DAYS[dayI],wd=st.wk[wN],pw=wN>1?st.wk[wN-1]:null;
  var dData=wd.ds[day.key],pDData=pw?pw.ds[day.key]:null;
  // Safety: ensure exercise data exists (belt-and-suspenders)
  day.exs.forEach(function(ex){if(!dData[ex.id])dData[ex.id]={s:mkS(ex.sets),tw:"",tr:""}});

  function upEx(eid,f,v){
    setSt(function(p){
      var n=JSON.parse(JSON.stringify(p));
      var ex=n.wk[wN].ds[day.key][eid];
      if(f==="tw"||f==="tr"){ex[f]=v}
      else if(f.indexOf("s_")===0){var ps=f.split("_");ex.s[parseInt(ps[1])][ps[2]]=v}
      return n;
    });
  }
  function upM(k,v){setSt(function(p){var n=JSON.parse(JSON.stringify(p));n.wk[wN].ms[k]=v;return n})}
  function upN(v){setSt(function(p){var n=JSON.parse(JSON.stringify(p));n.wk[wN].nt=v;return n})}

  function reorder(dayKey,exId,dir){
    setSt(function(p){
      var n=JSON.parse(JSON.stringify(p));
      if(!n.ord)n.ord={};
      if(!n.ord[dayKey]){var dd=DAYS.find(function(d){return d.key===dayKey});n.ord[dayKey]=dd.exs.map(function(e){return e.id})}
      var free=n.ord[dayKey].filter(function(id){var dd=DAYS.find(function(d){return d.key===dayKey});return dd.exs.some(function(e){return e.id===id&&!e.lk})});
      var idx=free.indexOf(exId);
      if(idx===-1)return n;
      var swapIdx=dir==="up"?idx-1:idx+1;
      if(swapIdx<0||swapIdx>=free.length)return n;
      var tmp=free[idx];free[idx]=free[swapIdx];free[swapIdx]=tmp;
      // Rebuild full order: locked first, then reordered free
      var dd=DAYS.find(function(d){return d.key===dayKey});
      var locked=dd.exs.filter(function(e){return e.lk}).map(function(e){return e.id});
      n.ord[dayKey]=locked.concat(free);
      return n;
    });
  }

  // Get ordered exercises
  var orderedExs=getOrderedExs(day,st.ord?st.ord[day.key]:null);
  var freeExs=orderedExs.filter(function(e){return!e.lk});

  // Stats
  var dDone=0,dTot=0;
  day.exs.forEach(function(ex){var d=dData[ex.id];if(d){dTot+=d.s.length;dDone+=d.s.filter(function(s){return s.d}).length}});
  var isToday=(function(){var dow=new Date().getDay();return dow>=1&&dow<=6&&dayI===dow-1})();

  return<div style={{minHeight:"100vh",background:"#08080d",color:"#fff",fontFamily:"'DM Sans',sans-serif",padding:"14px 12px 40px",maxWidth:500,margin:"0 auto"}}>
    {/* HEADER */}
    <div style={{textAlign:"center",marginBottom:12,position:"relative"}}>
      <div style={{fontSize:9,fontWeight:700,letterSpacing:2,textTransform:"uppercase",color:"rgba(255,255,255,.25)",marginBottom:4}}>COLOSSE ¬∑ PPL ¬∑ 4000 kcal/j</div>
      {sav&&<div style={{position:"absolute",top:0,right:4,fontSize:9,color:"#10B981",fontWeight:600}}>‚óè Sauv√©</div>}
    </div>

    {/* WEEK PILLS */}
    <div style={{display:"flex",gap:3,justifyContent:"center",marginBottom:10,flexWrap:"wrap"}}>
      {PHASES.map(function(p,i){return<button key={i} onClick={function(){setWk(i);setRd(getPhaseRest(p.p))}} style={{width:32,height:32,borderRadius:8,border:wk===i?"2px solid "+p.c:"1px solid rgba(255,255,255,.05)",background:wk===i?p.c+"20":"transparent",color:wk===i?"#fff":"rgba(255,255,255,.25)",fontSize:10,fontWeight:700,fontFamily:"'JetBrains Mono',monospace",cursor:"pointer"}}>S{p.w}</button>})}
    </div>

    {/* PHASE */}
    <div style={{textAlign:"center",marginBottom:12}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"center",gap:8,marginBottom:4}}>
        <span style={{padding:"3px 10px",borderRadius:6,background:ph.c,fontSize:10,fontWeight:700}}>SEM {wN}</span>
        <span style={{fontSize:11,fontWeight:600,color:"rgba(255,255,255,.4)"}}>{ph.p}</span>
        <span style={{fontSize:10,color:"rgba(255,255,255,.18)"}}>{ph.d}</span>
      </div>
      <div style={{fontSize:10,color:"rgba(255,255,255,.2)",fontStyle:"italic"}}>{(PCFG[ph.p]||{}).desc||""}</div>
      <div style={{fontSize:9,color:"rgba(255,255,255,.15)",marginTop:2}}>Compos√©s {(PCFG[ph.p]||{}).cLo}-{(PCFG[ph.p]||{}).cHi} reps ¬∑ Isolation {(PCFG[ph.p]||{}).iLo}-{(PCFG[ph.p]||{}).iHi} reps ¬∑ Repos {(PCFG[ph.p]||{}).rest}s</div>
    </div>

    {/* DAY SELECTOR */}
    <div style={{display:"flex",gap:3,marginBottom:14,overflowX:"auto"}}>
      {DAYS.map(function(d,i){
        var active=dayI===i;
        return<button key={i} onClick={function(){setDayI(i)}} style={{flex:"1 1 0",padding:"8px 2px 6px",borderRadius:10,border:active?"2px solid "+d.color:"1px solid rgba(255,255,255,.04)",background:active?d.color+"15":"transparent",cursor:"pointer",textAlign:"center",minWidth:48,position:"relative"}}>
          <div style={{fontSize:9,color:active?d.color:"rgba(255,255,255,.2)",fontWeight:700}}>{d.day.substring(0,3).toUpperCase()}</div>
          <div style={{fontSize:10,color:active?"#fff":"rgba(255,255,255,.3)",fontWeight:700,marginTop:2}}>{d.name}</div>
        </button>
      })}
    </div>

    {/* TODAY BADGE */}
    {isToday&&<div style={{textAlign:"center",marginBottom:10}}>
      <span style={{display:"inline-block",padding:"4px 14px",borderRadius:20,background:day.color+"20",border:"1px solid "+day.color+"40",fontSize:11,fontWeight:700,color:day.color}}>üìç S√âANCE DU JOUR</span>
    </div>}

    {/* SESSION HEADER */}
    <div style={{marginBottom:10,padding:"14px 16px",borderRadius:14,background:"linear-gradient(135deg,"+day.color+"12,"+day.color+"05)",border:"1px solid "+day.color+"20"}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
        <div>
          <div style={{fontSize:20,fontWeight:800,color:day.color}}>{day.name}</div>
          <div style={{fontSize:12,color:"rgba(255,255,255,.35)",marginTop:2}}>{day.label} ¬∑ {day.exs.length} exercices</div>
        </div>
        <div style={{textAlign:"right"}}>
          <div style={{fontFamily:"'JetBrains Mono',monospace",fontSize:24,fontWeight:800,color:"#fff"}}>{dTot>0?Math.round(dDone/dTot*100):0}%</div>
          <div style={{fontSize:10,color:"rgba(255,255,255,.25)"}}>{dDone}/{dTot} s√©ries</div>
        </div>
      </div>
      <div style={{marginTop:8}}><MBar v={dDone} mx={dTot} c={day.color}/></div>
    </div>

    {/* REST TIMER SETTING */}
    <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10,padding:"6px 12px",borderRadius:10,background:"rgba(255,255,255,.015)"}}>
      <span style={{fontSize:10,color:"rgba(255,255,255,.3)",fontWeight:600}}>‚è± Repos entre s√©ries</span>
      <div style={{display:"flex",gap:3}}>{REST_P.map(function(p){return<button key={p} onClick={function(){setRd(p)}} style={{padding:"3px 6px",borderRadius:5,border:rd===p?"1px solid "+day.color+"50":"1px solid rgba(255,255,255,.04)",background:rd===p?day.color+"12":"transparent",color:rd===p?day.color:"rgba(255,255,255,.2)",fontSize:9,fontWeight:600,fontFamily:"'JetBrains Mono',monospace",cursor:"pointer"}}>{p>=60?Math.floor(p/60)+"m":""}:{(p%60).toString().padStart(2,"0")}</button>})}</div>
    </div>

    {/* EXERCISES */}
    <div style={{paddingBottom:tmr?240:0}}>
      {orderedExs.map(function(ex){
        var fI=freeExs.indexOf(ex);
        return<ExCard key={ex.id} ex={ex} data={dData[ex.id]} prev={pDData&&pDData[ex.id]?pDData[ex.id]:null} color={day.color} upd={function(f,v){upEx(ex.id,f,v)}} onDone={function(){setTmr(true)}} isLk={!!ex.lk} canUp={!ex.lk&&fI>0} canDn={!ex.lk&&fI>=0&&fI<freeExs.length-1} onUp={function(){reorder(day.key,ex.id,"up")}} onDn={function(){reorder(day.key,ex.id,"down")}} phaseName={ph.p}/>;
      })}
    </div>

    {/* MEASUREMENTS */}
    <div style={{borderRadius:14,background:"rgba(255,255,255,.025)",border:"1px solid rgba(255,255,255,.06)",padding:"14px 16px",marginTop:14,marginBottom:12}}>
      <div style={{fontSize:10,fontWeight:700,textTransform:"uppercase",letterSpacing:1.2,color:"rgba(255,255,255,.35)",marginBottom:10}}>üìê Mensurations ‚Äî chaque Jeudi</div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(2,1fr)",gap:10}}>
        {MEAS.map(function(m){
          var pv=pw?pw.ms[m.id]:"",cv=wd.ms[m.id];
          var df=cv&&pv?(parseFloat(cv)-parseFloat(pv)):null;
          return<div key={m.id}>
            <div style={{fontSize:9,color:"rgba(255,255,255,.25)",fontWeight:600,marginBottom:3}}>{m.ic} {m.nm}</div>
            <div style={{display:"flex",alignItems:"center",gap:5}}>
              <Inp value={wd.ms[m.id]} onChange={function(v){upM(m.id,v)}} ph={pv||"‚Äî"} width={60}/>
              <span style={{fontSize:10,color:"rgba(255,255,255,.2)"}}>{m.u}</span>
              {df!==null&&df!==0&&!isNaN(df)&&<span style={{fontSize:9,fontWeight:700,color:(m.id==="taille"?(df<0?"#10B981":"#EF4444"):(df>0?"#10B981":"#EF4444"))}}>{df>0?"‚ñ≤":"‚ñº"}{Math.abs(df).toFixed(1)}</span>}
            </div>
          </div>
        })}
      </div>
    </div>

    {/* NOTES */}
    <div style={{borderRadius:14,background:"rgba(255,255,255,.025)",border:"1px solid rgba(255,255,255,.06)",padding:"14px 16px"}}>
      <div style={{fontSize:9,fontWeight:700,color:"rgba(255,255,255,.25)",textTransform:"uppercase",letterSpacing:1,marginBottom:6}}>üìù Notes</div>
      <textarea value={wd.nt} onChange={function(e){upN(e.target.value)}} placeholder="Sommeil, √©nergie, pump..." rows={2} style={{width:"100%",padding:"8px 10px",borderRadius:8,border:"1px solid rgba(255,255,255,.06)",background:"rgba(255,255,255,.03)",color:"#fff",fontSize:12,lineHeight:1.5,resize:"vertical",outline:"none",boxSizing:"border-box"}}/>
    </div>

    <div style={{textAlign:"center",marginTop:20,fontSize:8,color:"rgba(255,255,255,.1)"}}>Colosse Coach ¬∑ Sauvegarde locale ¬∑ Double progression</div>

    {tmr&&<Timer sec={rd} c={day.color} onEnd={function(){setTmr(false)}} onSkip={function(){setTmr(false)}} onDC={function(d){setRd(d)}}/>}
  </div>;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
<!-- PWA: Service Worker Registration + Update Banner -->
<script>
if('serviceWorker' in navigator){
  window.addEventListener('load',function(){
    navigator.serviceWorker.register('sw.js').then(function(reg){
      // Check for updates every 30 minutes
      setInterval(function(){reg.update()},30*60*1000);
      reg.addEventListener('updatefound',function(){
        var nw=reg.installing;
        nw.addEventListener('statechange',function(){
          if(nw.state==='installed'&&navigator.serviceWorker.controller){
            // New version available ‚Äî show reload banner
            var b=document.createElement('div');
            b.style.cssText='position:fixed;top:0;left:0;right:0;z-index:99999;background:#10B981;color:#fff;text-align:center;padding:12px 16px;font-family:DM Sans,sans-serif;font-size:13px;font-weight:700;cursor:pointer;';
            b.textContent='üîÑ Nouvelle version disponible ‚Äî Appuyer pour mettre √† jour';
            b.onclick=function(){nw.postMessage({type:'SKIP_WAITING'});window.location.reload()};
            document.body.appendChild(b);
          }
        });
      });
    }).catch(function(e){console.log('SW registration failed:',e)});
  });
}
</script>
</body>
</html>
